<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fear & Greed Index</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        /* 讓 App 更有原生感 */
        @media (display-mode: standalone) {
            .min-h-screen { padding-top: env(safe-area-inset-top); }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // 模擬 Lucide 圖示 (因為 CDN 版本用法不同)
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [time, setTime] = useState(new Date());
            const [fgiData, setFgiData] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            const fetchFgiData = async () => {
                setLoading(true);
                try {
                    // 使用公共 Proxy 解決 CORS 問題
                    const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://production.dataviz.cnn.io/index/fearandgreed/graphdata'));
                    const dataWrapper = await response.json();
                    const data = JSON.parse(dataWrapper.contents);
                    
                    const current = data.fear_and_greed;
                    setFgiData({
                        score: Math.round(current.score),
                        rating: getRatingInChinese(current.rating),
                        previousClose: Math.round(current.previous_close),
                        lastUpdated: new Date().toLocaleTimeString()
                    });
                } catch (err) {
                    setFgiData({ score: 65, rating: '貪婪 (Greed)', previousClose: 62, lastUpdated: '展示模式' });
                } finally { setLoading(false); }
            };

            useEffect(() => { fetchFgiData(); }, []);

            const getRatingInChinese = (r) => ({
                'extreme fear': '極度恐懼', 'fear': '恐懼', 'neutral': '中立', 'greed': '貪婪', 'extreme greed': '極度貪婪'
            }[r.toLowerCase()] || r);

            const getScoreColor = (s) => s <= 25 ? 'text-red-600' : s <= 45 ? 'text-orange-500' : s <= 55 ? 'text-yellow-500' : s <= 75 ? 'text-green-500' : 'text-emerald-600';
            const getBgColor = (s) => s <= 25 ? 'bg-red-50' : s <= 45 ? 'bg-orange-50' : s <= 55 ? 'bg-yellow-50' : s <= 75 ? 'bg-green-50' : 'bg-emerald-50';

            return (
                <div className="min-h-screen flex flex-col items-center p-4">
                    <div className="w-full max-w-md bg-white rounded-[2rem] shadow-2xl overflow-hidden flex flex-col">
                        <div className="bg-slate-900 p-8 text-center text-white">
                            <h1 className="text-5xl font-mono font-bold tracking-tighter">{time.toLocaleTimeString('en-GB')}</h1>
                            <p className="mt-2 text-slate-400 text-sm">{time.toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'long' })}</p>
                        </div>

                        <div className="p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">市場情緒</h2>
                                <button onClick={fetchFgiData} className="text-xs bg-blue-100 text-blue-600 px-4 py-2 rounded-full font-bold">刷新</button>
                            </div>

                            {loading && !fgiData ? (
                                <div className="text-center py-10 text-gray-400">連線中...</div>
                            ) : (
                                <div className={`rounded-3xl p-8 text-center transition-all ${getBgColor(fgiData?.score)}`}>
                                    <span className={`text-8xl font-black ${getScoreColor(fgiData?.score)}`}>{fgiData?.score}</span>
                                    <div className={`mt-4 text-2xl font-bold ${getScoreColor(fgiData?.score)}`}>{fgiData?.rating}</div>
                                    <div className="mt-6 h-3 w-full bg-gray-200 rounded-full flex overflow-hidden">
                                        <div className="h-full bg-red-600" style={{width:'25%'}}></div>
                                        <div className="h-full bg-orange-400" style={{width:'20%'}}></div>
                                        <div className="h-full bg-yellow-400" style={{width:'10%'}}></div>
                                        <div className="h-full bg-green-400" style={{width:'20%'}}></div>
                                        <div className="h-full bg-emerald-600" style={{width:'25%'}}></div>
                                    </div>
                                </div>
                            )}

                            <div className="mt-8 grid grid-cols-2 gap-4">
                                <div className="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-center">
                                    <div className="text-gray-400 text-xs mb-1">昨日收盤</div>
                                    <div className="text-xl font-bold text-gray-700">{fgiData?.previousClose}</div>
                                </div>
                                <div className="bg-gray-50 p-4 rounded-2xl border border-gray-100 text-center">
                                    <div className="text-gray-400 text-xs mb-1">更新時間</div>
                                    <div className="text-sm font-medium text-gray-700">{fgiData?.lastUpdated}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>